(function($) {
	
	$.timeOut = {
			// These properties can be read/written by accessing $.timeOut.params.propertyName from your scripts
			params:  {
				message      : 'Your session is about to expire.',
				keepAliveUrl : 'keepAlive.asp',
				redirUrl     : 'timedOut.asp',
				logoutUrl    : 'logout.asp',
				warnAfter    : 4000, //900000, // 15 minutes
				redirAfter   : 30000, //1200000, // 20 minutes
				logOutButton : "Salir",
				stayButton   : "Seguir Conectado",
				divTitle     : "Control de Sesión"
				},
			
			buildDialog: function() {
		        
				// Create timeout warning dialog
				$('body').append('<div title="'+$.timeOut.params.divTitle+'" id="sessionTimeout-dialog">'+ $.timeOut.params.message +'</div>');
				$('#sessionTimeout-dialog').dialog({
					autoOpen: false,
					draggable: !1,
					resizable: !1,
					width: 400,
					height: 200,
					modal: true,
					closeOnEscape: false,
					open: function(event, ui) { 
					                $(".ui-dialog-titlebar-close").hide(); 
				    },
					buttons: [
	                            {
	                                text: $.timeOut.params.logOutButton,
	                                click: function() {
	                            	 	window.location = $.timeOut.params.logoutUrl;
	                                }
	                            },
	                            {
	                                text: $.timeOut.params.stayButton,
	                                click: function() {
		                            	$(this).dialog('close');
		    							
		    							// Stop redirect timer and restart warning timer
		    							$.timeOut.controlRedirTimer('stop');
		    							$.timeOut.controlDialogTimer('start');
	                                }

	                            }
	                        ]
				});
		   
	       },
	
	       controlDialogTimer: function (action){
				switch(action) {
					case 'start':
						// After warning period, show dialog and start redirect timer
						dialogTimer = setTimeout(function(){
							$('#sessionTimeout-dialog').dialog('open');
							$.timeOut.controlRedirTimer('start');
						}, $.timeOut.params.warnAfter);
						break;
					
					case 'stop':
						clearTimeout(dialogTimer);
						break;
				}
			},
			
			controlRedirTimer: function (action){
				switch(action) {
					case 'start':
						// Dialog has been shown, if no action taken during redir period, redirect
						redirTimer = setTimeout(function(){
							window.location = $.timeOut.params.redirUrl;
						}, $.timeOut.params.redirAfter - $.timeOut.params.warnAfter);
						break;
					
					case 'stop':
						clearTimeout(redirTimer);
						break;
				}
			}
			
	  };
	
		timeOutStart = function(options) {
			if ($('#sessionTimeout-dialog').length > 0){
				timeOutReset();
			}else{
				// Extend user-set options over defaults
				if ( options ) { $.timeOut.params = $.extend( $.timeOut.params, options ); };
				$.timeOut.buildDialog();
				$.timeOut.controlDialogTimer('start');
			}
		};
		
		timeOutReset = function(){
			$.timeOut.controlDialogTimer('stop');
			$.timeOut.controlDialogTimer('start');
		};
	
   })(jQuery);


//getTopMostParentWindow().parent.timeOutReset();
//window.opener.parent.timeOutReset();